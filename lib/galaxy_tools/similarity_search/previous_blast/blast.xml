<tool id="blast" name="Similarity search">

    <description>with Blast</description>

    <macros>
        <xml name="strand_macro">
            <param name="strand" type="select" display="radio" label="Query strand(s) to search against database/subject?" help="">
                <option value="both">Both</option>
                <option value="minus">Minus</option>
                <option value="plus">Plus</option>
            </param>
        </xml>
        <xml name="query_gencode_macro">
            <param name="query_gencode" type="select" display="radio" label="Genetic code to use to translate query?" help="">
                <option value="1">1</option>
                <option value="2">2</option>
                <option value="3">3</option>
                <option value="4">4</option>
                <option value="5">5</option>
                <option value="6">6</option>
                <option value="9">9</option>
                <option value="10">10</option>
                <option value="11">11</option>
                <option value="12">12</option>
                <option value="13">13</option>
                <option value="14">14</option>
                <option value="15">15</option>
                <option value="16">16</option>
                <option value="21">21</option>
                <option value="22">22</option>
                <option value="23">23</option>
                <option value="24">24</option>
                <option value="25">25</option>
            </param>
        </xml>
        <xml name="blastn_task_macro">
            <param name="blastn_task" type="select" display="radio" label="Task to execute?" help="">
                <option value="blastn">blastn</option>
                <option value="blastn-short">blastn-short</option>
                <option value="dc-megablast">dc-megablast</option>
                <option value="megablast" selected="true">megablast</option>
                <option value="rmblastn">rmblastn</option>
            </param>
        </xml>
        <xml name="blastp_task_macro">
            <param name="blastp_task" type="select" display="radio" label="Task to execute?" help="">
                <option value="blastp" selected="true">blastp</option>
                <option value="blastp-fast">blastp-fast</option>
                <option value="blastp-short">blastp-short</option>
            </param>
        </xml>
        <xml name="blastx_task_macro">
            <param name="blastx_task" type="select" display="radio" label="Task to execute?" help="">
                <option value="blastx" selected="true">blastx</option>
                <option value="blastx-fast">blastx-fast</option>
            </param>
        </xml>
        <xml name="tblastn_task_macro">
            <param name="blastp_task" type="select" display="radio" label="Task to execute?" help="">
                <option value="tblastn" selected="true">tblastn</option>
                <option value="tblastn-fast">tblastn-fast</option>
            </param>
        </xml>
        <xml name="e_value_macro"><param name='e_value' type='float' min="0" max="100" value="10" label='Expectation value threshold for saving hits' help=""/></xml>
        <xml name="blastn_word_size_macro"><param name='blastn_word_size' type='integer' min="4" max="10" value="4" label='Word size for wordfinder algorithm' help="Length of best 
perfect match"/></xml>
        <xml name="other_blast_word_size_macro"><param name='other_blast_word_size' type='integer' min="2" max="10" value="2" label='Word size for wordfinder algorithm' help="Length of best 
perfect match"/></xml>
        <xml name="db_gencode_macro">
            <param name="db_gencode" type="select" display="radio" label="Genetic code to use to translate database/subjects?" help="">
                <option value="1">1</option>
                <option value="2">2</option>
                <option value="3">3</option>
                <option value="4">4</option>
                <option value="5">5</option>
                <option value="6">6</option>
                <option value="9">9</option>
                <option value="10">10</option>
                <option value="11">11</option>
                <option value="12">12</option>
                <option value="13">13</option>
                <option value="14">14</option>
                <option value="15">15</option>
                <option value="16">16</option>
                <option value="21">21</option>
                <option value="22">22</option>
                <option value="23">23</option>
                <option value="24">24</option>
                <option value="25">25</option>
            </param>
        </xml>
        <xml name="max_intron_length_macro"><param name='max_intron_length' type='integer' min="0" max="1000" value="0" label='Length of the largest intron allowed in a translated nucleotide sequence when linking multiple distinct alignments. ' help=""/></xml>
        <xml name="comp_based_stats_macro">
            <param name="comp_based_stats" type="select" display="radio" label="Use composition-based statistics?" help="">
                <option value="d" >default</option>
                <option value="0">No composition-based statistics</option>
                <option value="1">Composition-based statistics as in NAR 29:2994-3005, 2001</option>
                <option value="2" selected="true">Composition-based score adjustment as in Bioinformatics, 21:902-911, 2005, conditioned on sequence properties</option>
                <option value="3">Composition-based score adjustment as in Bioinformatics 21:902-911, 2005, unconditionally</option>
            </param>
        </xml>
        <xml name="use_index_macro"><param name='use_index' type='boolean' checked="false" truevalue='true' falsevalue='false' label="Use MegaBLAST database index?" help=""/>
        </xml>
    </macros>

    <requirements>
    </requirements>

    <stdio>
    </stdio>

    <version_command>
    </version_command>

    <!--<command>-->
    <command interpreter="python">
        blast_wrapper.py >
            --input_sequence_file $input_sequence_file

            #if str( $databases_type.databases_selector ) == 'history':
                #for $db in $databases_type.database_name
                    --db $db
                #end for
            #else:
                ## databases path is not directly accessible, must match by hand with LOC file contents
                #set $data_table = dict([(_[0], _[2]) for _ in $databases_type.input_databases.input.options.tool_data_table.data])
                #set $db_path=$os.getcwd() + '/'
                #set $db_path += $data_table[$db]
                --db $db_path
            #end if

            --os $os_info
            --blast_executable $blast.executable
            --similarity_search_report_file $similarity_search_report

            #if $blast.executable == 'blastn':
                --strand $strand
                --task $blastn_task
                --e_value $e_value
                --use_index $use_index
            #elif $blast.executable == 'blastp':
                --task $blastp_task
                --e_value $e_value
                --comp_based_stats $comp_based_stats
            #elif $blast.executable == 'blastx':
                --strand $strand
                --query_gencode $query_gencode
                --task $blastx_task
                --e_value $e_value
                --max_intron_length $max_intron_length
                --comp_based_stats $comp_based_stats
            #elif $blast.executable == 'tblastn':
                --task $tblastn_task
                --e_value $e_value
                --max_intron_length $max_intron_length
                --comp_based_stats $comp_based_stats
            #elif $blast.executable == 'tblastx':
                --strand $strand
                --query_gencode $query_gencode
                --e_value $e_value
                --db_gencode $db_gencode
                --max_intron_length $max_intron_length
            #end if

    </command>

    <inputs>
        <param name="os_info" type="select" display="radio" label="Computer OS?" help="">
            <option value="mac">Mac OSX</option>
            <option value="linux" selected="true">Linux</option>
            <!--<option value="window">Windows</option>-->
        </param>

        <param name="input_sequence_file" type="data" format="fasta" label="Input sequence file" help=""/>

        <conditional name="databases_type">
            <param name="databases_selector" type="select" display="radio" label="Databases to query" help="">
                <option value="cached" selected="true">Public databases</option>
                <option value="history">Databases from your history</option>
            </param>
            <when value="cached">
                <param name="input_databases" type="select" display="radio" label="Available databases" help="">
                    <options from_data_table="protein_databases" />
                    <validator type="no_options" message="Select at least one database"/>
                </param>
            </when>
            <when value="history">
                <param name="database_name" type="data" format="fasta" label="Databases" help=""/>
            </when>
        </conditional>

        <conditional name="blast">
            <param name="executable" type="select" display="radio" label="Blast search?" help="">
                <option value="blastn">Nucleotide-Nucleotide Blast (blastn) </option>
                <option value="blastp">Protein-Protein Blast (blastp) </option>
                <option value="blastx">Translated Query-Protein Subject Blast (blastx) </option>
                <option value="tblastn">Protein Query-Translated Subject Blast (tblastn) </option>
                <option value="tblastx">Translated Query-Translated Subject Blast (tblastp) </option>
            </param>
            <when value="blastn">
                <expand macro="strand" />
                <expand macro="blastn_task_macro" />
                <expand macro="e_value_macro" />
                <!--<expand macro="blastn_word_size_macro" />-->
                <expand macro="use_index_macro" />
            </when>
            <when value="blastp">
                <expand macro="blastp_task_macro" />
                <expand macro="e_value_macro" />
                <!--<expand macro="other_blast_word_size_macro" />-->
                <expand macro="comp_based_stats_macro" />
            </when>
            <when value="blastx">
                <expand macro="strand" />
                <expand macro="query_gencode_macro" />
                <expand macro="blastx_task_macro" />
                <expand macro="e_value_macro" />
                <!--<expand macro="other_blast_word_size_macro" />-->
                <expand macro="max_intron_length_macro" />
                <expand macro="comp_based_stats_macro" />
            </when>
            <when value="tblastn">
                <expand macro="tblastn_task_macro" />
                <expand macro="e_value_macro" />
                <!--<expand macro="other_blast_word_size_macro" />-->
                <expand macro="db_gencode_macro" />
                <expand macro="max_intron_length_macro" />
                <expand macro="comp_based_stats_macro" />
            </when>
            <when value="tblastx">
                <expand macro="strand" />
                <expand macro="query_gencode_macro" />
                <expand macro="e_value_macro" />
                <expand macro="db_gencode_macro" />
                <expand macro="max_intron_length_macro" />
                <!--<expand macro="other_blast_word_size_macro" />-->
            </when>
        </conditional>

        
        <param name='word_size' type='integer' min="4" max="100" value="10" label='Expectation value threshold for saving hits' help=""/>
    
    </inputs>

    <outputs>
        <data format="text" name="similarity_search_report" label="similarity_search_report_${input_sequence_file.name}"/>
    </outputs>

    <tests>
    </tests>

    <help>
        **What it does**

        
        Version: 2.2.31+

        **Input**

        


        **Outputs**


        **Parameters**
    </help>

    <citations>
    </citations>
</tool>