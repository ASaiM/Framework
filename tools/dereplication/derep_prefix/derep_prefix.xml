<tool id="derep_prefix" name="Dereplication using prefix matching">

	<description>with derep_prefix of usearch</description>

    <macros>
    </macros>

	<requirements>
  	</requirements>

    <stdio>
        
    </stdio>

    <version_command></version_command>

  	<!--<command>-->
    <command>
        src/usearch -derep_prefix $sequence_file_format.input_sequence_file
            #if $sequence_file_format.format == 'fasta':
                -fastaout $unique_sequence_file
            #else:
                -fastqout $unique_sequence_file
            #end if

            #if $size_annotation == 'yes':
                -sizeout
            #end if

            #if $minimum_size.test == 'yes':
                -minuniquesize $minimum_size.value
            #end if

            #if $minimum_seq_length.test == 'yes':
                -minseqlength $minimum_seq_length.value
            #end if

            #if $relabel.test == 'yes':
                -relabel $relabel.value
            #end if

            #if $eliminate_cluster.test == 'yes':
                -topn $eliminate_cluster.value
            #end if
    </command>

  	<inputs>
        <conditional name="sequence_file_format">
            <param name="format" type="select" display="radio" label="Sequence file format?" help="">
                <option value="fasta" selected="true">Fasta</option>
                <option value="fastq">FastQ</option>
            </param>
            <when value="fasta">
                <param name="input_sequence_file" type="data" format="fasta" label="Input sequence file" help=""/>
            </when>
            <when value="fastq">
                <param name="input_sequence_file" type="data" format="fastq" label="Input sequence file" help=""/>
            </when>
        </conditional>  

        <param name="size_annotation" type="select" display="radio" label="Addition of size annotations to the unique sequence labels?" help="">
            <option value="yes" selected="true">Yes</option>
            <option value="no">No</option>
        </param>

        <conditional name="minimum_size">
            <param name="test" type="select" display="radio" label="Set a minimum size for cluster?" help="Unique sequences with smaller clusters are not included in the output file">
                <option value="yes">Yes</option>
                <option value="no"  selected="true">No</option>
            </param>
            <when value="yes">
                <param name="value" type="integer" min="0" max="1000" value="2" label="Minimum size for cluster" help=""/>
            </when>
        </conditional>

        <conditional name="minimum_seq_length">
            <param name="test" type="select" display="radio" label="Set a minimum sequence length?" help="Using this option may significantly improve execution speed if there are very short sequences in the input which are not needed in the output">
                <option value="yes">Yes</option>
                <option value="no" selected="true">No</option>
            </param>
            <when value="yes">
                <param name="value" type="integer" min="0" max="1000" value="2" label="Minimum sequence length" help=""/>
            </when>
        </conditional>

        <conditional name="relabel">
            <param name="test" type="select" display="radio" label="Relabel?" help="A string is used to re-label the dereplicated sequences. An integer is appended to the label">
                <option value="yes">Yes</option>
                <option value="no" selected="true">No</option>
            </param>
            <when value="yes">
                <param name="value" type="text" size="30" value="" label="New prefix" help=""/>
            </when>
        </conditional>

        <conditional name="eliminate_cluster">
            <param name="test" type="select" display="radio" label="Conserve only the largest clusters?" help="">
                <option value="yes">Yes</option>
                <option value="no" selected="true">No</option>
            </param>
            <when value="yes">
                <param name="value" type="integer" min="0" max="1000" value="2" label="Number of largest cluster to conserve" help=""/>
            </when>
        </conditional>
  	</inputs>

  	<outputs>
        <data format="fastq" name="unique_sequence_file" label="uniques_${input_sequence_file}" >
        <filter>((sequence_file_format['format'] == 'fastq' ))</filter>
        </data>

        <data format="fasta" name="unique_sequence_file" label="uniques_${input_sequence_file}" >
        <filter>((sequence_file_format['format'] == 'fasta' ))</filter>
        </data>
  	</outputs>

  	<tests>
  
  	</tests>

  	<help>
        **What it does**

        Dereplication is the identification of unique sequences so that only one copy of each sequence is reported. 

        Here, derep_prefix command of usearch tool is used.


        **Input**

        The input is one sequence file.


        **Outputs**


        **Parameters**


  	</help>

    <citations>
    </citations>
</tool>

